<div class="flex flex-wrap gap-4 justify-between items-center mb-10">
    <div>
        <h1 class="text-3xl font-bold">
            Hello {{ firstWord(authService.me()!.name) }}
        </h1>
        <p class="text-xs text-primary-content flex items-center gap-1">
            <i-lucide [img]="Calendar" class="my-icon w-4 h-4"></i-lucide>
            <span>{{ authService.me()!.created_at | date }}</span>
            <span>|</span>
            @if (authService.me()!.verified_at === null) {
            <i-lucide
                [img]="NotVerified"
                class="w-4 h-4 text-error-content"
            ></i-lucide>
            <span class="text-error-content">Unverified</span>
            } @else {
            <i-lucide [img]="Verified" class="my-icon w-4 h-4"></i-lucide>
            <span class="text-success">Verified</span>
            }
            <span>|</span>
            <i-lucide [img]="ProfilesIcon" class="my-icon w-4 h-4"></i-lucide>
            <span
                >{{ profiles ? `${profiles.length} Profiles` : "Fetching profiles..." }}</span
            >
        </p>
    </div>
    <a routerLink="/new-profile" class="ml-auto btn btn-primary">
        <i-lucide [img]="New" class="my-icon"></i-lucide>
        New profile
    </a>
</div>

@if (authService.me()!.verified_at === null) {
<app-unverified-user class="flex justify-center mb-10"></app-unverified-user>
}

<p class="text-sm mb-2">
    {{ profiles ? "Profiles" : "Fetching profiles..." }}
</p>
@if (profiles === null) {
<div class="flex justify-center items-center h-32">
    <span class="loading loading-spinner loading-lg"></span>
</div>
} @else { @if (profiles.length === 0) {
<div class="card bg-neutral shadow-xl max-w-4xl w-full">
    <div class="card-body items-center text-center gap-6 p-8">
        <img class="max-w-32 w-full" src="illustrations/empty.svg" />
        <div>
            <h1 class="text-3xl font-bold text-base-content">
                No Profile found
            </h1>

            <p class="text-sm text-base-content/50">
                You dont have any profile available yet
            </p>
        </div>

        <div class="flex w-full justify-center gap-4 flex-wrap">
            <a routerLink="/new-profile" class="btn btn-primary btn-wide">
                <i-lucide [img]="New" class="my-icon"></i-lucide>
                Create a new profile
            </a>
        </div>
    </div>
</div>
} @else {
<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
    @for (profile of profiles; track profile.ID) {
    <div class="card bg-neutral shadow-xl hover:shadow-2xl transition-shadow">
        <div class="card-body p-6">
            <!-- Profile Header -->
            <div class="flex items-start justify-between mb-4">
                <div class="flex-1 min-w-0">
                    <h2 class="card-title text-xl font-bold truncate mb-1">
                        {{ profile.Name }}
                    </h2>
                    <p
                        class="text-xs text-base-content/60 flex items-center gap-1"
                    >
                        <i-lucide [img]="Calendar" class="w-3 h-3"></i-lucide>
                        <span>{{ profile.CreatedAt | date : "short" }}</span>
                    </p>
                </div>
                <!-- Dropdown Menu -->
                <div class="dropdown dropdown-end">
                    <div
                        tabindex="0"
                        role="button"
                        class="btn btn-sm btn-square btn-ghost"
                    >
                        <i-lucide
                            [img]="MoreVerticalIcon"
                            class="w-4 h-4"
                        ></i-lucide>
                    </div>
                    <ul
                        tabindex="0"
                        class="dropdown-content menu bg-base-100 rounded-box z-1 w-52 p-2 shadow-xl border border-base-300"
                    >
                        <li>
                            <a [routerLink]="['/edit-profile', profile.ID]">
                                <i-lucide
                                    [img]="EditIcon"
                                    class="w-4 h-4"
                                ></i-lucide>
                                Edit Profile
                            </a>
                        </li>
                        <li>
                            <a
                                (click)="deleteProfile(profile.ID)"
                                class="text-error"
                            >
                                <i-lucide
                                    [img]="TrashIcon"
                                    class="w-4 h-4"
                                ></i-lucide>
                                Delete Profile
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Profile Stats -->
            <div class="flex gap-2 mb-4">
                <div class="badge badge-sm gap-1">
                    <i-lucide [img]="ActivityIcon" class="w-3 h-3"></i-lucide>
                    {{ getTrackerCount(profile.Trackers) }} Trackers
                </div>
            </div>

            <!-- Token Section -->
            <div class="mb-4">
                <p class="text-xs text-base-content/60 mb-1">Token</p>
                <div class="flex items-center gap-2">
                    <input
                        type="password"
                        class="input input-sm input-bordered flex-1 font-mono text-xs"
                        [value]="profile.Token"
                        readonly
                    />
                    <button
                        class="btn btn-sm btn-square btn-ghost"
                        (click)="copyToken(profile.Token)"
                        title="Copy token"
                    >
                        <i-lucide [img]="CopyIcon" class="w-4 h-4"></i-lucide>
                    </button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card-actions justify-end gap-2 flex-wrap">
                <button
                    class="btn btn-sm btn-primary flex-1"
                    (click)="viewLogs(profile.ID)"
                    title="View logs"
                >
                    <i-lucide [img]="EyeIcon" class="w-4 h-4"></i-lucide>
                    View Logs
                </button>
            </div>
        </div>
    </div>
    }
</div>
} }
