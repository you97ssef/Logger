@if (loading) {
<div class="flex justify-center items-center h-screen">
    <span class="loading loading-spinner loading-lg"></span>
</div>
} @else if (profile) {
<!-- Header -->
<div class="flex flex-wrap gap-4 justify-between items-center mb-6">
    <div>
        <h1 class="text-3xl font-bold flex items-center gap-2">
            <i-lucide [img]="FileTextIcon" class="my-icon"></i-lucide>
            {{ profile.Name }}
        </h1>
        <p class="text-sm text-base-content/60 mt-1">
            Viewing logs for this profile @if (wsConnected) {
            <span class="badge badge-success badge-sm ml-2 gap-1">
                <i-lucide [img]="WifiIcon" class="w-3 h-3"></i-lucide>
                Live
            </span>
            } @else {
            <span class="badge badge-ghost badge-sm ml-2 gap-1">
                <i-lucide [img]="WifiOffIcon" class="w-3 h-3"></i-lucide>
                Offline
            </span>
            }
        </p>
    </div>
    <div class="flex gap-2 flex-wrap">
        <button
            class="btn btn-sm btn-primary"
            (click)="testLog()"
            [disabled]="loadingEntries"
            title="Send test log"
        >
            <i-lucide [img]="SendIcon" class="my-icon"></i-lucide>
            Test Log
        </button>
        <button
            class="btn btn-sm btn-ghost"
            (click)="editProfile()"
            title="Edit profile"
        >
            <i-lucide [img]="EditIcon" class="my-icon"></i-lucide>
            Edit Profile
        </button>
        <a routerLink="/" class="btn btn-sm btn-ghost" title="Back to home">
            <i-lucide [img]="HomeIcon" class="my-icon"></i-lucide>
            Home
        </a>
    </div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="card bg-neutral shadow-md">
        <div class="card-body p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-base-content/60">Total Logs</p>
                    <p class="text-2xl font-bold">{{ totalEntries }}</p>
                </div>
                <i-lucide
                    [img]="FileTextIcon"
                    class="w-8 h-8 text-primary"
                ></i-lucide>
            </div>
        </div>
    </div>

    <div class="card bg-neutral shadow-md">
        <div class="card-body p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-base-content/60">Current Page</p>
                    <p class="text-2xl font-bold">
                        {{ currentPage }} / {{ totalPages || 1 }}
                    </p>
                </div>
                <i-lucide
                    [img]="CalendarIcon"
                    class="w-8 h-8 text-primary"
                ></i-lucide>
            </div>
        </div>
    </div>

    <div class="card bg-neutral shadow-md">
        <div class="card-body p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-base-content/60">Showing</p>
                    <p class="text-2xl font-bold">
                        {{ filteredEntries.length }}
                    </p>
                </div>
                <i-lucide
                    [img]="InfoIcon"
                    class="w-8 h-8 text-primary"
                ></i-lucide>
            </div>
        </div>
    </div>
</div>

<!-- Search and Actions -->
<div class="flex flex-wrap gap-3 mb-6">
    <div class="flex-1 min-w-64">
        <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            class="input input-bordered w-full"
            placeholder="Search logs..."
        />
    </div>
    @if (searchTerm) {
    <button class="btn btn-ghost" (click)="clearSearch()">Clear</button>
    }
    <button
        class="btn btn-error"
        (click)="clearAllLogs()"
        [disabled]="totalEntries === 0"
        title="Delete all logs"
    >
        <i-lucide [img]="TrashIcon" class="my-icon"></i-lucide>
        Clear All
    </button>
</div>

<!-- Logs Content -->
@if (loadingEntries) {
<div class="flex justify-center items-center h-64">
    <span class="loading loading-spinner loading-lg"></span>
</div>
} @else { @if (filteredEntries.length === 0) {
<div class="card bg-neutral shadow-xl">
    <div class="card-body items-center text-center gap-6 p-12">
        <img class="max-w-32 w-full" src="illustrations/empty.svg" />
        <div>
            <h2 class="text-2xl font-bold text-base-content">No logs found</h2>
            <p class="text-sm text-base-content/50 mt-2">
                @if (searchTerm) { No logs match your search criteria. } @else {
                This profile doesn't have any logs yet. }
            </p>
        </div>
        @if (searchTerm) {
        <button class="btn btn-primary" (click)="clearSearch()">
            Clear Search
        </button>
        }
    </div>
</div>
} @else {
<!-- Log Entries -->
<div class="space-y-3">
    @for (entry of filteredEntries; track entry.ID) {
    <div
        class="card bg-neutral shadow-md hover:shadow-lg transition-shadow border-l-4"
        [class.border-error]="getLogLevelClass(entry.Text) === 'badge-error'"
        [class.border-warning]="
            getLogLevelClass(entry.Text) === 'badge-warning'
        "
        [class.border-info]="getLogLevelClass(entry.Text) === 'badge-info'"
        [class.border-accent]="getLogLevelClass(entry.Text) === 'badge-accent'"
        [class.border-base-300]="getLogLevelClass(entry.Text) === 'badge-ghost'"
    >
        <div class="card-body p-4">
            <div class="flex items-start gap-3">
                <div class="shrink-0 mt-1">
                    <i-lucide
                        [img]="getLogLevelIcon(entry.Text)"
                        class="w-5 h-5"
                        [class.text-error]="
                            getLogLevelClass(entry.Text) === 'badge-error'
                        "
                        [class.text-warning]="
                            getLogLevelClass(entry.Text) === 'badge-warning'
                        "
                        [class.text-info]="
                            getLogLevelClass(entry.Text) === 'badge-info'
                        "
                        [class.text-accent]="
                            getLogLevelClass(entry.Text) === 'badge-accent'
                        "
                    ></i-lucide>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between gap-3 mb-2">
                        <div
                            class="badge badge-sm"
                            [ngClass]="getLogLevelClass(entry.Text)"
                        >
                            {{
                                getLogLevelClass(entry.Text).replace(
                                    "badge-",
                                    ""
                                )
                            }}
                        </div>
                        <div
                            class="text-xs text-base-content/60 flex items-center gap-1 shrink-0"
                        >
                            <i-lucide
                                [img]="ClockIcon"
                                class="w-3 h-3"
                            ></i-lucide>
                            {{ entry.CreatedAt | date : "medium" }}
                        </div>
                    </div>
                    <p
                        class="text-sm font-mono whitespace-pre-wrap wrap-break-word"
                    >
                        {{ entry.Text }}
                    </p>
                </div>
            </div>
        </div>
    </div>
    }
</div>

<!-- Pagination -->
@if (totalPages > 1) {
<div class="flex justify-center items-center gap-2 mt-6">
    <button
        class="btn btn-sm"
        (click)="previousPage()"
        [disabled]="currentPage === 1 || loadingEntries"
    >
        <i-lucide [img]="ChevronLeftIcon" class="my-icon"></i-lucide>
        Previous
    </button>
    <span class="text-sm px-4">
        Page {{ currentPage }} of {{ totalPages }}
    </span>
    <button
        class="btn btn-sm"
        (click)="nextPage()"
        [disabled]="!hasNextPage() || loadingEntries"
    >
        Next
        <i-lucide [img]="ChevronRightIcon" class="my-icon"></i-lucide>
    </button>
</div>
} } } }
